# Wonk 聊天机器人项目计划书

## 项目概述

### 项目目标
开发一个本地运行的FAQ聊天机器人，支持中英文双语，能够基于预设的问答对识别相似问题并提供准确回答，完全离线运行，无需依赖付费AI服务，具备商业化潜力。

### 核心需求
- **数据类型**: 问答对（FAQ格式）
- **语言支持**: 中英文双语
- **数据规模**: 初期10条左右，可扩展
- **部署要求**: 本地运行，离线可用
- **商业考量**: 避免版权风险，可商用
- **开发优先级**: 功能优先，UI后续

## 技术架构

### 整体架构
```
用户输入 → 预处理 → 多路检索 → 相似度计算 → 置信度判断 → 答案返回
```

### 核心组件
1. **数据存储层**: SQLite + FTS5全文检索
2. **检索引擎**: BM25关键词检索 + 语义向量检索
3. **相似度计算**: 多策略融合评分
4. **API服务**: FastAPI RESTful接口
5. **管理工具**: 数据导入/导出/索引重建

### 技术栈选择
- **后端**: Python 3.10+ + FastAPI + Uvicorn
- **数据库**: SQLite（内置FTS5）
- **向量检索**: FAISS + sentence-transformers
- **多语言模型**: multilingual-e5-small（MIT许可，商用友好）
- **前端**: 初期命令行，后续简单Web界面

## 实施计划

### 第一阶段：基础架构搭建（1-2天）

#### 1.1 项目初始化
- [x] 创建项目目录结构
- [ ] 设置Python虚拟环境
- [ ] 安装基础依赖包
- [ ] 配置开发环境

#### 1.2 数据模型设计
```sql
-- FAQ表
CREATE TABLE faqs (
    id INTEGER PRIMARY KEY,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    language TEXT DEFAULT 'zh',
    tags TEXT,
    source TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- FTS5全文检索表
CREATE VIRTUAL TABLE faqs_fts USING fts5(
    question, answer, tags,
    content='faqs',
    content_rowid='id'
);
```

#### 1.3 核心模块框架
- `data_manager.py`: 数据导入/导出/管理
- `retriever.py`: 检索引擎（BM25 + 语义）
- `matcher.py`: 相似度计算与融合
- `api.py`: FastAPI接口
- `config.py`: 配置管理

### 第二阶段：检索引擎开发（2-3天）

#### 2.1 BM25关键词检索
- 实现SQLite FTS5查询
- 中英文分词处理
- 关键词权重调优

#### 2.2 语义向量检索
- 集成multilingual-e5-small模型
- 构建FAISS向量索引
- 实现向量相似度计算

#### 2.3 多路检索融合
- BM25 + 语义检索结果合并
- 归一化评分算法
- 置信度阈值机制

### 第三阶段：API服务开发（1-2天）

#### 3.1 核心API接口
```python
POST /api/query          # 查询问答
POST /api/ingest         # 导入数据
GET  /api/faqs           # 获取FAQ列表
PUT  /api/faqs/{id}      # 更新FAQ
DELETE /api/faqs/{id}    # 删除FAQ
POST /api/rebuild_index  # 重建索引
```

#### 3.2 查询响应格式
```json
{
    "query": "用户问题",
    "answer": "匹配的答案",
    "confidence": 0.85,
    "source_id": 123,
    "candidates": [
        {"question": "候选问题1", "confidence": 0.75},
        {"question": "候选问题2", "confidence": 0.65}
    ]
}
```

### 第四阶段：数据管理工具（1天）

#### 4.1 数据导入
- 支持CSV/JSON/Excel格式
- 批量导入验证
- 重复数据检测

#### 4.2 索引管理
- 自动索引构建
- 增量更新机制
- 索引状态监控

### 第五阶段：测试与优化（1-2天）

#### 5.1 功能测试
- 单元测试覆盖
- 集成测试
- 性能基准测试

#### 5.2 参数调优
- 置信度阈值调整
- 检索权重优化
- 响应时间优化

### 第六阶段：部署与文档（1天）

#### 6.1 部署准备
- 一键启动脚本
- 依赖打包
- 配置文件模板

#### 6.2 文档编写
- 用户使用手册
- API文档
- 维护指南

## 项目目录结构

```
wonk-chatbot/
├── README.md
├── requirements.txt
├── config.yaml
├── run.bat                 # Windows一键启动
├── app/
│   ├── __init__.py
│   ├── main.py            # FastAPI应用入口
│   ├── api/
│   │   ├── __init__.py
│   │   ├── query.py       # 查询接口
│   │   └── manage.py      # 管理接口
│   ├── core/
│   │   ├── __init__.py
│   │   ├── retriever.py   # 检索引擎
│   │   ├── matcher.py     # 相似度计算
│   │   └── data_manager.py # 数据管理
│   ├── models/
│   │   ├── __init__.py
│   │   └── schemas.py     # 数据模型
│   └── utils/
│       ├── __init__.py
│       ├── text_processor.py # 文本预处理
│       └── logger.py      # 日志工具
├── data/
│   ├── database.db        # SQLite数据库
│   ├── vectors/           # 向量索引文件
│   └── samples/           # 示例数据
├── scripts/
│   ├── import_data.py     # 数据导入脚本
│   ├── rebuild_index.py   # 重建索引
│   └── test_queries.py    # 测试查询
├── tests/
│   ├── __init__.py
│   ├── test_retriever.py
│   ├── test_matcher.py
│   └── test_api.py
└── docs/
    ├── API.md
    ├── 使用手册.md
    └── 部署指南.md
```

## 关键技术决策

### 模型选择（商用友好）
- **multilingual-e5-small**: MIT许可，支持中英文，模型小（<500MB）
- **备选**: paraphrase-multilingual-MiniLM-L12-v2（Apache 2.0）
- **避免**: 任何GPL/CC BY-NC许可的模型

### 检索策略
1. **第一层**: BM25关键词匹配（快速筛选）
2. **第二层**: 语义向量相似度（精确匹配）
3. **融合**: 加权平均 + 置信度阈值

### 置信度设计
- **高置信度** (>0.8): 直接返回答案
- **中置信度** (0.5-0.8): 返回答案+候选
- **低置信度** (<0.5): 拒答+建议

## 风险评估与应对

### 技术风险
- **模型版权**: 选择MIT/Apache许可模型
- **性能瓶颈**: 数据量增长时的响应时间
- **准确率**: 小数据集的过拟合问题

### 应对措施
- 严格筛选开源许可
- 实现分层缓存机制
- 设计数据增强策略

## 成功标准

### 功能指标
- [x] 支持中英文问答导入
- [ ] 查询响应时间 < 500ms
- [ ] 准确匹配率 > 85%
- [ ] 支持10-1000条FAQ扩展

### 质量指标
- [ ] 单元测试覆盖率 > 80%
- [ ] API稳定性 > 99%
- [ ] 内存占用 < 1GB

## 后续扩展方向

### 短期优化（1-2周）
- Web UI界面开发
- 批量测试工具
- 性能监控面板

### 中期增强（1-2月）
- 多轮对话上下文
- 答案个性化调整
- 数据分析报表

### 长期规划（3-6月）
- 多租户支持
- 分布式部署
- 高级NLP功能

## 预算与资源

### 开发成本
- 开发时间: 5-7天（MVP版本）
- 硬件要求: 普通PC（8GB内存推荐）
- 软件成本: 0元（全开源方案）

### 运营成本
- 服务器: 可选（本地部署为主）
- 维护: 低（SQLite + 静态模型）
- 扩展: 按需（数据量增长时）

---

**项目负责人**: AI Assistant  
**创建日期**: 2025-08-08  
**版本**: v1.0  
**状态**: 待确认
